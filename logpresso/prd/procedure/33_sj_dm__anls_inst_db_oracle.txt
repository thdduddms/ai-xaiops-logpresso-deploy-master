파라미터 : [int system_id, datetime from_date, datetime to_date]
설명 : JOB] analysis inst_db(ORACLE) DM 생성 데이터 !!임시!! import 주석처리해놓음

set inst_product_type = "ORACLE" 
| setq [ table duration=10m exem_aiops_anls_inst_db 
 	| search inst_product_type==$("inst_product_type") and system_id == $("system_id")
      | stats max(_time) as last_time 
      | eval last_time = nvl(last_time, datetrunc(dateadd(now(), "min", -10), "1m"))
      | fields last_time ] 

| table from=$("from_date") to=$("to_date") dl__anls_inst_db 
| search inst_product_type==$("inst_product_type") and _time > $("last_time")  

| eval _time = datetrunc(_time, "1m")
| stats 
avg(active_sessions) as active_sessions, 
avg(buffer_busy_waits) as buffer_busy_waits, 
avg(concurrency_wait_time) as concurrency_wait_time, 
avg(consistent_gets) as consistent_gets, 
avg(cpu_used_by_this_session) as cpu_used_by_this_session, 
avg(cursor_pin_s_wait_on_x) as cursor_pin_s_wait_on_x, 
avg(db_block_changes) as db_block_changes, 
avg(db_block_gets) as db_block_gets, 
avg(db_file_scattered_read) as db_file_scattered_read, 
avg(db_file_sequential_read) as db_file_sequential_read, 
avg(db_time) as db_time, 
avg(enq_sq_contention) as enq_sq_contention, 
avg(enq_tx_index_contention) as enq_tx_index_contention, 
avg(enq_tx_row_lock_contention) as enq_tx_row_lock_contention, 
avg(enqueue_requests) as enqueue_requests, 
avg(enqueue_waits) as enqueue_waits, 
avg(execute_count) as execute_count, 
avg(file_io_service_time) as file_io_service_time, 
avg(file_io_wait_time) as file_io_wait_time, 
avg(free_buffer_waits) as free_buffer_waits, 
avg(gc_buffer_busy_acquire) as gc_buffer_busy_acquire, 
avg(gc_buffer_busy_release) as gc_buffer_busy_release, 
avg(gc_cr_block_busy) as gc_cr_block_busy, 
avg(gc_cr_blocks_received) as gc_cr_blocks_received, 
avg(gc_cr_multi_block_request) as gc_cr_multi_block_request, 
avg(gc_cr_request) as gc_cr_request, 
avg(gc_current_block_busy) as gc_current_block_busy, 
avg(gc_current_blocks_received) as gc_current_blocks_received, 
avg(gc_current_multi_block_request) as gc_current_multi_block_request, 
avg(gc_current_request) as gc_current_request, 
avg(global_enqueue_gets_async) as global_enqueue_gets_async, 
avg(global_enqueue_gets_sync) as global_enqueue_gets_sync, 
avg(latch_cache_buffers_chains) as latch_cache_buffers_chains, 
avg(latch_shared_pool) as latch_shared_pool, 
avg(library_cache_lock) as library_cache_lock, 
avg(library_cache_mutex_x) as library_cache_mutex_x, 
avg(library_cache_pin) as library_cache_pin, 
avg(lock_waiting_sessions) as lock_waiting_sessions, 
avg(log_buffer_space) as log_buffer_space, 
avg(log_file_sequential_read) as log_file_sequential_read, 
avg(log_file_switch_archiving_needed) as log_file_switch_archiving_needed, 
avg(log_file_switch_checkpoint_incomplete) as log_file_switch_checkpoint_incomplete, 
avg(log_file_switch_completion) as log_file_switch_completion, 
avg(log_file_sync) as log_file_sync, 
avg(non_idle_wait_time) as non_idle_wait_time, 
avg(parse_time_elapsed) as parse_time_elapsed, 
avg(physical_reads) as physical_reads, 
avg(physical_reads_direct) as physical_reads_direct, 
avg(physical_writes) as physical_writes, 
avg(physical_writes_direct) as physical_writes_direct, 
avg(read_by_other_session) as read_by_other_session, 
avg(recursive_calls) as recursive_calls, 
avg(redo_size) as redo_size, 
avg(row_cache_lock) as row_cache_lock, 
avg(session_logical_reads) as session_logical_reads, 
avg(user_calls) as user_calls, 
avg(user_commits) as user_commits, 
avg(user_rollbacks) as user_rollbacks
by system_id, _target, _time

| eval
    time = string(_time, "yyyy-MM-dd HH:mm:ss"),
    inst_type="db",
    inst_product_type = $("inst_product_type"), 
    active_sessions = nvl(active_sessions, 0),
    buffer_busy_waits = nvl(buffer_busy_waits, 0),
    concurrency_wait_time = nvl(concurrency_wait_time, 0),
    consistent_gets = nvl(consistent_gets, 0),
    cpu_used_by_this_session = nvl(cpu_used_by_this_session, 0),
    db_block_changes = nvl(db_block_changes, 0),
    db_block_gets = nvl(db_block_gets, 0),
    db_file_scattered_read = nvl(db_file_scattered_read, 0),
    db_file_sequential_read = nvl(db_file_sequential_read, 0),
    db_time = nvl(db_time, 0),
    execute_count = nvl(execute_count, 0),
    file_io_service_time = nvl(file_io_service_time, 0),
    file_io_wait_time = nvl(file_io_wait_time, 0),
    free_buffer_waits = nvl(free_buffer_waits, 0),
    gc_cr_blocks_received = nvl(gc_cr_blocks_received, 0),
    gc_cr_request = nvl(gc_cr_request, 0),
    gc_current_blocks_received = nvl(gc_current_blocks_received, 0),
    global_enqueue_gets_async = nvl(global_enqueue_gets_async, 0),
    global_enqueue_gets_sync = nvl(global_enqueue_gets_sync, 0),
    library_cache_lock = nvl(library_cache_lock, 0),
    lock_waiting_sessions = nvl(lock_waiting_sessions, 0),
    log_buffer_space = nvl(log_buffer_space, 0),
    log_file_sync = nvl(log_file_sync, 0),
    non_idle_wait_time = nvl(non_idle_wait_time, 0),
    parse_time_elapsed = nvl(parse_time_elapsed, 0),
    physical_reads = nvl(physical_reads, 0),
    physical_reads_direct = nvl(physical_reads_direct, 0),
    physical_writes = nvl(physical_writes, 0),
    physical_writes_direct = nvl(physical_writes_direct, 0),
    recursive_calls = nvl(recursive_calls, 0),
    redo_size = nvl(redo_size, 0),
    row_cache_lock = nvl(row_cache_lock, 0),
    session_logical_reads = nvl(session_logical_reads, 0),
    user_calls = nvl(user_calls, 0),
    user_commits = nvl(user_commits, 0),
    user_rollbacks = nvl(user_rollbacks, 0),
    enqueue_requests = nvl(enqueue_requests, 0),
    enqueue_waits = nvl(enqueue_waits, 0),
    cursor_pin_s_wait_on_x = nvl(cursor_pin_s_wait_on_x, 0),
    enq_sq_contention = nvl(enq_sq_contention, 0),
    enq_tx_index_contention = nvl(enq_tx_index_contention, 0),
    enq_tx_row_lock_contention = nvl(enq_tx_row_lock_contention, 0),
    gc_buffer_busy_acquire = nvl(gc_buffer_busy_acquire, 0),
    gc_buffer_busy_release = nvl(gc_buffer_busy_release, 0),
    gc_cr_block_busy = nvl(gc_cr_block_busy, 0),
    gc_cr_multi_block_request = nvl(gc_cr_multi_block_request, 0),
    gc_current_block_busy = nvl(gc_current_block_busy, 0),
    gc_current_multi_block_request = nvl(gc_current_multi_block_request, 0),
    gc_current_request = nvl(gc_current_request, 0),
    latch_cache_buffers_chains = nvl(latch_cache_buffers_chains, 0),
    latch_shared_pool = nvl(latch_shared_pool, 0),
    library_cache_pin = nvl(library_cache_pin, 0),
    library_cache_mutex_x = nvl(library_cache_mutex_x, 0),
    log_file_switch_archiving_needed = nvl(log_file_switch_archiving_needed, 0),
    log_file_switch_checkpoint_incomplete = nvl(log_file_switch_checkpoint_incomplete, 0),
    log_file_switch_completion = nvl(log_file_switch_completion, 0),
    read_by_other_session = nvl(read_by_other_session, 0),
    log_file_sequential_read = nvl(log_file_sequential_read, 0),
    free_buffer_waits = nvl(free_buffer_waits, 0)
    
| set floor_decimal = 2
| eval 
active_sessions = floor(active_sessions, $("floor_decimal")), 
buffer_busy_waits = floor(buffer_busy_waits, $("floor_decimal")), 
concurrency_wait_time = floor(concurrency_wait_time, $("floor_decimal")), 
consistent_gets = floor(consistent_gets, $("floor_decimal")), 
cpu_used_by_this_session = floor(cpu_used_by_this_session, $("floor_decimal")), 
cursor_pin_s_wait_on_x = floor(cursor_pin_s_wait_on_x, $("floor_decimal")), 
db_block_changes = floor(db_block_changes, $("floor_decimal")), 
db_block_gets = floor(db_block_gets, $("floor_decimal")), 
db_file_scattered_read = floor(db_file_scattered_read, $("floor_decimal")), 
db_file_sequential_read = floor(db_file_sequential_read, $("floor_decimal")), 
db_time = floor(db_time, $("floor_decimal")), 
enq_sq_contention = floor(enq_sq_contention, $("floor_decimal")), 
enq_tx_index_contention = floor(enq_tx_index_contention, $("floor_decimal")), 
enq_tx_row_lock_contention = floor(enq_tx_row_lock_contention, $("floor_decimal")), 
enqueue_requests = floor(enqueue_requests, $("floor_decimal")), 
enqueue_waits = floor(enqueue_waits, $("floor_decimal")), 
execute_count = floor(execute_count, $("floor_decimal")), 
file_io_service_time = floor(file_io_service_time, $("floor_decimal")), 
file_io_wait_time = floor(file_io_wait_time, $("floor_decimal")), 
free_buffer_waits = floor(free_buffer_waits, $("floor_decimal")), 
gc_buffer_busy_acquire = floor(gc_buffer_busy_acquire, $("floor_decimal")), 
gc_buffer_busy_release = floor(gc_buffer_busy_release, $("floor_decimal")), 
gc_cr_block_busy = floor(gc_cr_block_busy, $("floor_decimal")), 
gc_cr_blocks_received = floor(gc_cr_blocks_received, $("floor_decimal")), 
gc_cr_multi_block_request = floor(gc_cr_multi_block_request, $("floor_decimal")), 
gc_cr_request = floor(gc_cr_request, $("floor_decimal")), 
gc_current_block_busy = floor(gc_current_block_busy, $("floor_decimal")), 
gc_current_blocks_received = floor(gc_current_blocks_received, $("floor_decimal")), 
gc_current_multi_block_request = floor(gc_current_multi_block_request, $("floor_decimal")), 
gc_current_request = floor(gc_current_request, $("floor_decimal")), 
global_enqueue_gets_async = floor(global_enqueue_gets_async, $("floor_decimal")), 
global_enqueue_gets_sync = floor(global_enqueue_gets_sync, $("floor_decimal")), 
latch_cache_buffers_chains = floor(latch_cache_buffers_chains, $("floor_decimal")), 
latch_shared_pool = floor(latch_shared_pool, $("floor_decimal")), 
library_cache_lock = floor(library_cache_lock, $("floor_decimal")), 
library_cache_mutex_x = floor(library_cache_mutex_x, $("floor_decimal")), 
library_cache_pin = floor(library_cache_pin, $("floor_decimal")), 
lock_waiting_sessions = floor(lock_waiting_sessions, $("floor_decimal")), 
log_buffer_space = floor(log_buffer_space, $("floor_decimal")), 
log_file_sequential_read = floor(log_file_sequential_read, $("floor_decimal")), 
log_file_switch_archiving_needed = floor(log_file_switch_archiving_needed, $("floor_decimal")), 
log_file_switch_checkpoint_incomplete = floor(log_file_switch_checkpoint_incomplete, $("floor_decimal")), 
log_file_switch_completion = floor(log_file_switch_completion, $("floor_decimal")), 
log_file_sync = floor(log_file_sync, $("floor_decimal")), 
non_idle_wait_time = floor(non_idle_wait_time, $("floor_decimal")), 
parse_time_elapsed = floor(parse_time_elapsed, $("floor_decimal")), 
physical_reads = floor(physical_reads, $("floor_decimal")), 
physical_reads_direct = floor(physical_reads_direct, $("floor_decimal")), 
physical_writes = floor(physical_writes, $("floor_decimal")), 
physical_writes_direct = floor(physical_writes_direct, $("floor_decimal")), 
read_by_other_session = floor(read_by_other_session, $("floor_decimal")), 
recursive_calls = floor(recursive_calls, $("floor_decimal")), 
redo_size = floor(redo_size, $("floor_decimal")), 
row_cache_lock = floor(row_cache_lock, $("floor_decimal")), 
session_logical_reads = floor(session_logical_reads, $("floor_decimal")), 
user_calls = floor(user_calls, $("floor_decimal")), 
user_commits = floor(user_commits, $("floor_decimal")), 
user_rollbacks = floor(user_rollbacks, $("floor_decimal"))

| # import exem_aiops_anls_inst_db 