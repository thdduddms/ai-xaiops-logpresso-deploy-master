파라미터 : [int system_id, datetime from_date, datetime to_date]
설명 : JOB] analysis inst_db(TIBERO) DM 생성 데이터 !!임시!! import 주석처리해놓음

set inst_product_type = "TIBERO"
| setq [ table duration=10m exem_aiops_anls_inst_db 
 	| search inst_product_type==$("inst_product_type") and system_id == $("system_id")
      | stats max(_time) as last_time 
      | eval last_time = nvl(last_time, datetrunc(dateadd(now(), "min", -10), "1m"))
      | fields last_time ] 

| table from=$("from_date") to=$("to_date") dl__anls_inst_db 
| search inst_product_type==$("inst_product_type") and _time > $("last_time")  

| eval _time = datetrunc(_time, "1m")
| stats 
avg(cr_block_received) as cr_block_received, 
avg(db_cpu) as db_cpu, 
avg(execute_count) as execute_count, 
avg(hard_parse_elapsed_time) as hard_parse_elapsed_time, 
avg(lock_waiting_sessions) as lock_waiting_sessions, 
avg(parse_count_failures) as parse_count_failures, 
avg(parse_count_hard) as parse_count_hard, 
avg(parse_count_total) as parse_count_total, 
avg(parse_time_elapsed) as parse_time_elapsed, 
avg(physical_reads) as physical_reads, 
avg(redo_entries) as redo_entries, 
avg(redo_log_size) as redo_log_size, 
avg(running_sessions) as running_sessions, 
avg(session_logical_reads) as session_logical_reads, 
avg(sort_time) as sort_time, 
avg(sorts_disk) as sorts_disk, 
avg(sorts_memory) as sorts_memory, 
avg(transactions) as transactions, 
avg(user_calls) as user_calls, 
avg(user_rollbacks) as user_rollbacks, 
avg(we_buf_wait) as we_buf_wait, 
avg(we_ccc_ast_cr) as we_ccc_ast_cr, 
avg(we_ccc_ast_cur) as we_ccc_ast_cur, 
avg(we_ccc_ast_mbr) as we_ccc_ast_mbr, 
avg(we_jc_buf_disk_read) as we_jc_buf_disk_read, 
avg(we_jc_buf_disk_readm) as we_jc_buf_disk_readm, 
avg(we_jc_dbwr_write_os) as we_jc_dbwr_write_os, 
avg(we_jc_dpbuf_wait_write) as we_jc_dpbuf_wait_write, 
avg(we_log_flush_commit) as we_log_flush_commit, 
avg(we_spin_alloc_lru) as we_spin_alloc_lru, 
avg(we_spin_buf_bucket) as we_spin_buf_bucket, 
avg(we_spin_buf_ws) as we_spin_buf_ws, 
avg(we_spin_shp_alloc) as we_spin_shp_alloc, 
avg(we_wlock_cf) as we_wlock_cf, 
avg(we_wlock_df_extend) as we_wlock_df_extend, 
avg(we_wlock_dml) as we_wlock_dml, 
avg(we_wlock_seq_get_nextval) as we_wlock_seq_get_nextval, 
avg(we_wlock_sess) as we_wlock_sess, 
avg(we_wlock_split) as we_wlock_split, 
avg(we_wlock_temp_granule) as we_wlock_temp_granule, 
avg(we_wlock_tx) as we_wlock_tx
by system_id, _target, _time

| eval
    time = string(_time, "yyyy-MM-dd HH:mm:ss"),
    inst_type="db",
    inst_product_type = $("inst_product_type"), 
    db_cpu=nvl(db_cpu, 0),
    transactions=nvl(transactions, 0),
    user_calls=nvl(user_calls, 0),
    user_rollbacks=nvl(user_rollbacks, 0),
    redo_entries=nvl(redo_entries, 0),
    redo_log_size=nvl(redo_log_size, 0),
    execute_count=nvl(execute_count, 0),
    running_sessions=nvl(running_sessions, 0),
    lock_waiting_sessions=nvl(lock_waiting_sessions, 0),
    session_logical_reads=nvl(session_logical_reads, 0),
    physical_reads=nvl(physical_reads, 0),
    cr_block_received=nvl(cr_block_received, 0),
    parse_count_total=nvl(parse_count_total, 0),
    parse_count_hard=nvl(parse_count_hard, 0),
    parse_count_failures=nvl(parse_count_failures, 0),
    parse_time_elapsed=nvl(parse_time_elapsed, 0),
    hard_parse_elapsed_time=nvl(hard_parse_elapsed_time, 0),
    sort_time=nvl(sort_time, 0),
    sorts_memory=nvl(sorts_memory, 0),
    sorts_disk=nvl(sorts_disk, 0),
    we_jc_dbwr_write_os=nvl(we_jc_dbwr_write_os, 0),
    we_wlock_dml=nvl(we_wlock_dml, 0),
    we_wlock_tx=nvl(we_wlock_tx, 0),
    we_wlock_split=nvl(we_wlock_split, 0),
    we_wlock_seq_get_nextval=nvl(we_wlock_seq_get_nextval, 0),
    we_spin_buf_ws=nvl(we_spin_buf_ws, 0),
    we_spin_buf_bucket=nvl(we_spin_buf_bucket, 0),
    we_spin_shp_alloc=nvl(we_spin_shp_alloc, 0),
    we_spin_alloc_lru=nvl(we_spin_alloc_lru, 0),
    we_wlock_sess=nvl(we_wlock_sess, 0),
    we_jc_buf_disk_readm=nvl(we_jc_buf_disk_readm, 0),
    we_jc_buf_disk_read=nvl(we_jc_buf_disk_read, 0),
    we_wlock_temp_granule=nvl(we_wlock_temp_granule, 0),
    we_jc_dpbuf_wait_write=nvl(we_jc_dpbuf_wait_write, 0),
    we_wlock_df_extend=nvl(we_wlock_df_extend, 0),
    we_buf_wait=nvl(we_buf_wait, 0),
    we_wlock_cf=nvl(we_wlock_cf, 0),
    we_log_flush_commit=nvl(we_log_flush_commit, 0),
    we_ccc_ast_mbr=nvl(we_ccc_ast_mbr, 0),
    we_ccc_ast_cr=nvl(we_ccc_ast_cr, 0),
    we_ccc_ast_cur=nvl(we_ccc_ast_cur, 0)
  
| set floor_decimal = 2
| eval
cr_block_received = floor(cr_block_received, $("floor_decimal")), 
db_cpu = floor(db_cpu, $("floor_decimal")), 
execute_count = floor(execute_count, $("floor_decimal")), 
hard_parse_elapsed_time = floor(hard_parse_elapsed_time, $("floor_decimal")), 
lock_waiting_sessions = floor(lock_waiting_sessions, $("floor_decimal")), 
parse_count_failures = floor(parse_count_failures, $("floor_decimal")), 
parse_count_hard = floor(parse_count_hard, $("floor_decimal")), 
parse_count_total = floor(parse_count_total, $("floor_decimal")), 
parse_time_elapsed = floor(parse_time_elapsed, $("floor_decimal")), 
physical_reads = floor(physical_reads, $("floor_decimal")), 
redo_entries = floor(redo_entries, $("floor_decimal")), 
redo_log_size = floor(redo_log_size, $("floor_decimal")), 
running_sessions = floor(running_sessions, $("floor_decimal")), 
session_logical_reads = floor(session_logical_reads, $("floor_decimal")), 
sort_time = floor(sort_time, $("floor_decimal")), 
sorts_disk = floor(sorts_disk, $("floor_decimal")), 
sorts_memory = floor(sorts_memory, $("floor_decimal")), 
transactions = floor(transactions, $("floor_decimal")), 
user_calls = floor(user_calls, $("floor_decimal")), 
user_rollbacks = floor(user_rollbacks, $("floor_decimal")), 
we_buf_wait = floor(we_buf_wait, $("floor_decimal")), 
we_ccc_ast_cr = floor(we_ccc_ast_cr, $("floor_decimal")), 
we_ccc_ast_cur = floor(we_ccc_ast_cur, $("floor_decimal")), 
we_ccc_ast_mbr = floor(we_ccc_ast_mbr, $("floor_decimal")), 
we_jc_buf_disk_read = floor(we_jc_buf_disk_read, $("floor_decimal")), 
we_jc_buf_disk_readm = floor(we_jc_buf_disk_readm, $("floor_decimal")), 
we_jc_dbwr_write_os = floor(we_jc_dbwr_write_os, $("floor_decimal")), 
we_jc_dpbuf_wait_write = floor(we_jc_dpbuf_wait_write, $("floor_decimal")), 
we_log_flush_commit = floor(we_log_flush_commit, $("floor_decimal")), 
we_spin_alloc_lru = floor(we_spin_alloc_lru, $("floor_decimal")), 
we_spin_buf_bucket = floor(we_spin_buf_bucket, $("floor_decimal")), 
we_spin_buf_ws = floor(we_spin_buf_ws, $("floor_decimal")), 
we_spin_shp_alloc = floor(we_spin_shp_alloc, $("floor_decimal")), 
we_wlock_cf = floor(we_wlock_cf, $("floor_decimal")), 
we_wlock_df_extend = floor(we_wlock_df_extend, $("floor_decimal")), 
we_wlock_dml = floor(we_wlock_dml, $("floor_decimal")), 
we_wlock_seq_get_nextval = floor(we_wlock_seq_get_nextval, $("floor_decimal")), 
we_wlock_sess = floor(we_wlock_sess, $("floor_decimal")), 
we_wlock_split = floor(we_wlock_split, $("floor_decimal")), 
we_wlock_temp_granule = floor(we_wlock_temp_granule, $("floor_decimal")), 
we_wlock_tx = floor(we_wlock_tx, $("floor_decimal"))
    
| # import exem_aiops_anls_inst_db 